Starting at Wed Jun  7 11:37:09 PM UTC 2023
Current working directory is /home/leonkl/cme-213/final_project
The master node of this job is: icmet04
Number of compute nodes: 1
Compute node names: icmet04
Using 4 tasks per node.
Number of CPUs on node: 4.
----------------

* Mode 1 *
mpirun -np 2 ./main -g 1
Number of MPI processes         2
Number of CUDA devices          4
Grading mode on; grading mode   1
Number of neurons            1000
Number of epochs               40
Batch size                    800
Regularization      9.9999997e-05
Learning rate       0.00050000002
The sequential code is not run
The debug option is on
The output directory is ./Outputs
The CPU results are loaded from ./cpu_results
Loading training data
Training data information:
Size of x_train, N =  60000
Size of label_train = 60000
Loading testing data

Start Parallel Training
The error in the GPU calculation during training is saved to ./Outputs/CpuGpuDiff-2-1.txt
Loss at iteration 0 of epoch 0/40 = 2.32892
Loading CPU data W0 from file ./cpu_results/seq_epoch-W0-0-1.mat
Loading CPU data W1 from file ./cpu_results/seq_epoch-W1-0-1.mat
Loading CPU data b0 from file ./cpu_results/seq_epoch-b0-0-1.mat
Loading CPU data b1 from file ./cpu_results/seq_epoch-b1-0-1.mat
Loss at iteration 600 of epoch 8/40 = 1.30662
Loading CPU data W0 from file ./cpu_results/seq_epoch-W0-600-1.mat
Loading CPU data W1 from file ./cpu_results/seq_epoch-W1-600-1.mat
Loading CPU data b0 from file ./cpu_results/seq_epoch-b0-600-1.mat
Loading CPU data b1 from file ./cpu_results/seq_epoch-b1-600-1.mat
Loss at iteration 1200 of epoch 17/40 = 0.835654
Loading CPU data W0 from file ./cpu_results/seq_epoch-W0-1200-1.mat
Loading CPU data W1 from file ./cpu_results/seq_epoch-W1-1200-1.mat
Loading CPU data b0 from file ./cpu_results/seq_epoch-b0-1200-1.mat
Loading CPU data b1 from file ./cpu_results/seq_epoch-b1-1200-1.mat
Loss at iteration 1800 of epoch 26/40 = 0.63484
Loading CPU data W0 from file ./cpu_results/seq_epoch-W0-1800-1.mat
Loading CPU data W1 from file ./cpu_results/seq_epoch-W1-1800-1.mat
Loading CPU data b0 from file ./cpu_results/seq_epoch-b0-1800-1.mat
Loading CPU data b1 from file ./cpu_results/seq_epoch-b1-1800-1.mat
Loss at iteration 2400 of epoch 35/40 = 0.562146
Loading CPU data W0 from file ./cpu_results/seq_epoch-W0-2400-1.mat
Loading CPU data W1 from file ./cpu_results/seq_epoch-W1-2400-1.mat
Loading CPU data b0 from file ./cpu_results/seq_epoch-b0-2400-1.mat
Loading CPU data b1 from file ./cpu_results/seq_epoch-b1-2400-1.mat
Time for Parallel Training: 19.05 seconds
Precision on validation set for parallel training =   0.9104999899864197
Precision on testing set for parallel training =   0.8920000195503235

Checking for correctness...
Loading from file ./cpu_results/seq_nn-W0-1.mat
Loading from file ./cpu_results/seq_nn-b0-1.mat
Loading from file ./cpu_results/seq_nn-W1-1.mat
Loading from file ./cpu_results/seq_nn-b1-1.mat

The error in the GPU DNN at the completion of training is saved to ./Outputs/NNErrors-2-1.txt
Max norm of diff b/w seq and par: W[0]: 1.29027e-07, b[0]: 8.4556e-07
l2  norm of diff b/w seq and par: W[0]: 1.48764e-07, b[0]: 5.29403e-07
Max norm of diff b/w seq and par: W[1]: 1.45084e-07, b[1]: 1.00644e-06
l2  norm of diff b/w seq and par: W[1]: 1.43135e-07, b[1]: 8.5829e-07

* Mode 2 *
mpirun -np 2 ./main -g 2
Number of MPI processes         2
Number of CUDA devices          4
Grading mode on; grading mode   2
Number of neurons            1000
Number of epochs               10
Batch size                    800
Regularization      9.9999997e-05
Learning rate               0.001
The sequential code is not run
The debug option is on
The output directory is ./Outputs
The CPU results are loaded from ./cpu_results
Loading training data
Training data information:
Size of x_train, N =  60000
Size of label_train = 60000
Loading testing data

Start Parallel Training
The error in the GPU calculation during training is saved to ./Outputs/CpuGpuDiff-2-2.txt
Loss at iteration 0 of epoch 0/10 = 2.32892
Loading CPU data W0 from file ./cpu_results/seq_epoch-W0-0-2.mat
Loading CPU data W1 from file ./cpu_results/seq_epoch-W1-0-2.mat
Loading CPU data b0 from file ./cpu_results/seq_epoch-b0-0-2.mat
Loading CPU data b1 from file ./cpu_results/seq_epoch-b1-0-2.mat
Loss at iteration 150 of epoch 2/10 = 1.61267
Loading CPU data W0 from file ./cpu_results/seq_epoch-W0-150-2.mat
Loading CPU data W1 from file ./cpu_results/seq_epoch-W1-150-2.mat
Loading CPU data b0 from file ./cpu_results/seq_epoch-b0-150-2.mat
Loading CPU data b1 from file ./cpu_results/seq_epoch-b1-150-2.mat
Loss at iteration 300 of epoch 4/10 = 1.34281
Loading CPU data W0 from file ./cpu_results/seq_epoch-W0-300-2.mat
Loading CPU data W1 from file ./cpu_results/seq_epoch-W1-300-2.mat
Loading CPU data b0 from file ./cpu_results/seq_epoch-b0-300-2.mat
Loading CPU data b1 from file ./cpu_results/seq_epoch-b1-300-2.mat
Loss at iteration 450 of epoch 6/10 = 0.890752
Loading CPU data W0 from file ./cpu_results/seq_epoch-W0-450-2.mat
Loading CPU data W1 from file ./cpu_results/seq_epoch-W1-450-2.mat
Loading CPU data b0 from file ./cpu_results/seq_epoch-b0-450-2.mat
Loading CPU data b1 from file ./cpu_results/seq_epoch-b1-450-2.mat
Loss at iteration 600 of epoch 8/10 = 0.918119
Loading CPU data W0 from file ./cpu_results/seq_epoch-W0-600-2.mat
Loading CPU data W1 from file ./cpu_results/seq_epoch-W1-600-2.mat
Loading CPU data b0 from file ./cpu_results/seq_epoch-b0-600-2.mat
Loading CPU data b1 from file ./cpu_results/seq_epoch-b1-600-2.mat
Time for Parallel Training: 6.21831 seconds
Precision on validation set for parallel training =   0.8845000267028809
Precision on testing set for parallel training =   0.8647999763488770

Checking for correctness...
Loading from file ./cpu_results/seq_nn-W0-2.mat
Loading from file ./cpu_results/seq_nn-b0-2.mat
Loading from file ./cpu_results/seq_nn-W1-2.mat
Loading from file ./cpu_results/seq_nn-b1-2.mat

The error in the GPU DNN at the completion of training is saved to ./Outputs/NNErrors-2-2.txt
Max norm of diff b/w seq and par: W[0]: 9.5994e-08, b[0]: 5.652e-07
l2  norm of diff b/w seq and par: W[0]: 1.06821e-07, b[0]: 3.92046e-07
Max norm of diff b/w seq and par: W[1]: 1.06961e-07, b[1]: 3.50911e-07
l2  norm of diff b/w seq and par: W[1]: 1.14861e-07, b[1]: 3.17506e-07

* Mode 3 *
mpirun -np 2 ./main -g 3
Number of MPI processes         2
Number of CUDA devices          4
Grading mode on; grading mode   3
Number of neurons            1000
Number of epochs                1
Batch size                    800
Regularization      9.9999997e-05
Learning rate        0.0020000001
The sequential code is not run
The debug option is on
The output directory is ./Outputs
The CPU results are loaded from ./cpu_results
Loading training data
Training data information:
Size of x_train, N =  60000
Size of label_train = 60000
Loading testing data

Start Parallel Training
The error in the GPU calculation during training is saved to ./Outputs/CpuGpuDiff-2-3.txt
Loss at iteration 0 of epoch 0/1 = 2.32892
Loading CPU data W0 from file ./cpu_results/seq_epoch-W0-0-3.mat
Loading CPU data W1 from file ./cpu_results/seq_epoch-W1-0-3.mat
Loading CPU data b0 from file ./cpu_results/seq_epoch-b0-0-3.mat
Loading CPU data b1 from file ./cpu_results/seq_epoch-b1-0-3.mat
Loss at iteration 15 of epoch 0/1 = 2.14962
Loading CPU data W0 from file ./cpu_results/seq_epoch-W0-15-3.mat
Loading CPU data W1 from file ./cpu_results/seq_epoch-W1-15-3.mat
Loading CPU data b0 from file ./cpu_results/seq_epoch-b0-15-3.mat
Loading CPU data b1 from file ./cpu_results/seq_epoch-b1-15-3.mat
Loss at iteration 30 of epoch 0/1 = 2.00007
Loading CPU data W0 from file ./cpu_results/seq_epoch-W0-30-3.mat
Loading CPU data W1 from file ./cpu_results/seq_epoch-W1-30-3.mat
Loading CPU data b0 from file ./cpu_results/seq_epoch-b0-30-3.mat
Loading CPU data b1 from file ./cpu_results/seq_epoch-b1-30-3.mat
Loss at iteration 45 of epoch 0/1 = 1.88414
Loading CPU data W0 from file ./cpu_results/seq_epoch-W0-45-3.mat
Loading CPU data W1 from file ./cpu_results/seq_epoch-W1-45-3.mat
Loading CPU data b0 from file ./cpu_results/seq_epoch-b0-45-3.mat
Loading CPU data b1 from file ./cpu_results/seq_epoch-b1-45-3.mat
Loss at iteration 60 of epoch 0/1 = 1.72596
Loading CPU data W0 from file ./cpu_results/seq_epoch-W0-60-3.mat
Loading CPU data W1 from file ./cpu_results/seq_epoch-W1-60-3.mat
Loading CPU data b0 from file ./cpu_results/seq_epoch-b0-60-3.mat
Loading CPU data b1 from file ./cpu_results/seq_epoch-b1-60-3.mat
Time for Parallel Training: 2.34442 seconds
Precision on validation set for parallel training =   0.7853333353996277
Precision on testing set for parallel training =   0.7652999758720398

Checking for correctness...
Loading from file ./cpu_results/seq_nn-W0-3.mat
Loading from file ./cpu_results/seq_nn-b0-3.mat
Loading from file ./cpu_results/seq_nn-W1-3.mat
Loading from file ./cpu_results/seq_nn-b1-3.mat

The error in the GPU DNN at the completion of training is saved to ./Outputs/NNErrors-2-3.txt
Max norm of diff b/w seq and par: W[0]: 3.71238e-08, b[0]: 4.92726e-07
l2  norm of diff b/w seq and par: W[0]: 5.36255e-08, b[0]: 2.76012e-07
Max norm of diff b/w seq and par: W[1]: 4.54575e-08, b[1]: 3.99422e-07
l2  norm of diff b/w seq and par: W[1]: 6.20971e-08, b[1]: 3.83206e-07

*** Summary ***

2400           1.1962e-07     1.34436e-07    7.47397e-07    1.10692e-06    1.40857e-07    1.36921e-07    4.98022e-07    8.30705e-07    
600            8.68742e-08    1.00217e-07    5.46872e-07    3.78715e-07    1.00119e-07    1.10025e-07    3.79736e-07    3.52767e-07    
60             3.5465e-08     4.23647e-08    5.24248e-07    3.12126e-07    5.08737e-08    5.87769e-08    2.79114e-07    3.05572e-07    

*** Grading mode 4 ***

main -g 4
Number of MPI processes         4
Number of CUDA devices          4

Entering GEMM Benchmarking mode! Stand by.

Starting GEMM 1: M = 8003; N = 10000; K = 7840
GEMM matched with reference successfully! Rel diff = 4.99265e-08
Time for reference GEMM implementation: 0.490213 seconds
Time for my GEMM implementation: 4.95836 seconds
Completed GEMM 1

Starting GEMM 2: M = 8000; N = 1000; K = 10000
GEMM matched with reference successfully! Rel diff = 5.08913e-08
Time for reference GEMM implementation: 0.0629416 seconds
Time for my GEMM implementation: 0.697667 seconds
Completed GEMM 2

Starting GEMM 3: M = 8000; N = 100; K = 10000
GEMM matched with reference successfully! Rel diff = 1.07542e-06
Time for reference GEMM implementation: 0.00815674 seconds
Time for my GEMM implementation: 0.0858738 seconds
Completed GEMM 3

*** Tests are complete ***
